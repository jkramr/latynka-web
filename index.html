<div class="form-group">
  <textarea id="inputk" class="form-control" rows="4">
Введіть текст кирилицею</textarea>
</div>
<div class="form-group" style="text=align: center;">
  <button type="button" id="submitk" class="btn btn-primary">Pereklasty</button>
</div>
<link rel="stylesheet" href="https://cdn/jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js">
<script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
<script>
  function latynka(word) {
    var answer = '';
    var lowerCase = {
      'а': 'a',
      'б': 'b',
      'в': 'v',
      'г': 'g',
      'ґ': 'ĝ',
      'д': 'd',
      'е': 'e',
      'ж': 'ž',
      'з': 'z',
      'и': 'y',
      'і': 'i',
      'й': 'j',
      'к': 'k',
      'л': 'l',
      'м': 'm',
      'н': 'n',
      'о': 'o',
      'п': 'p',
      'р': 'r',
      'с': 's',
      'т': 't',
      'у': 'u',
      'ф': 'f',
      'х': 'h',
      'ц': 'c',
      'ч': 'č',
      'ш': 'š'
    };
    var upperCase = {
      'А': 'A',
      'Б': 'B',
      'В': 'V',
      'Г': 'G',
      'Ґ': 'Ĝ',
      'Д': 'D',
      'Е': 'E',
      'Ж': 'Ž',
      'З': 'Z',
      'И': 'Y',
      'І': 'I',
      'Й': 'J',
      'К': 'K',
      'Л': 'L',
      'М': 'M',
      'Н': 'N',
      'О': 'O',
      'П': 'P',
      'Р': 'R',
      'С': 'S',
      'Т': 'T',
      'У': 'U',
      'Ф': 'F',
      'Х': 'H',
      'Ц': 'C',
      'Ч': 'Č',
      'Ш': 'Š',
    };
    var digraphs = {
      //ё
      'йо': 'jo',
      'ьо': 'jo'
    };
    var reverseDigraphs = {
      'є': 'je',
      'ї': 'ji',
      'щ': 'šč',
      'ю': 'ju',
      'я': 'ja',
      'Є': 'Je',
      'Ї': 'Ji',
      'Щ': 'ŠČ',
      'Ю': 'Ju',
      'Я': 'Ja'
    };
    var special = {
      'Ь': '\'',
      'ь': '\'',
      '\'': '\''
    };
    var converter = {
      ...lowerCase,
      ...upperCase,
      ...reverseDigraphs,
      ...special,
      ...digraphs
    };
    var i = 0;
    while (i < word.length) {
      if (converter[word[i]] == undefined) {
        answer += word[i];
        i++;
      } else {
        if (i + 1 < word.length) {
          var digraph = word[i] + word[i + 1];
          if (digraphs[digraph]) {
            answer += converter[digraph];
            i += 2;
          } else {
            answer += converter[word[i]];
            i++;
          }
        } else {
          answer += converter[word[i]];
          i++;
        }
      }
    }
    return answer;
  }

  $('#submitk').click(function() {
    $('#inputk').val(function(i, val) {
      return latynka(val);
    });
    return false;
  });

</script>

<div class="form-group">
  <textarea id="inputl" class="form-control" rows="4">
Vvedit' tekst latynkoju</textarea>
</div>
<div class="form-group" style="text=align: center;">
  <button type="button" id="submitl" class="btn btn-primary">Pereklasty</button>
</div>
<link rel="stylesheet" href="https://cdn/jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js">
<script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
<script>
  function kyrylka(word) {
    var answer = '';
    var lowerCase = {
      'a': 'а',
      'b': 'б',
      'v': 'в',
      'g': 'г',
      'ĝ': 'ґ',
      'd': 'д',
      'e': 'е',
      'ž': 'ж',
      'z': 'з',
      'y': 'и',
      'i': 'і',
      'j': 'й',
      'k': 'к',
      'l': 'л',
      'm': 'м',
      'n': 'н',
      'o': 'о',
      'p': 'п',
      'r': 'р',
      's': 'с',
      't': 'т',
      'u': 'у',
      'f': 'ф',
      'h': 'х',
      'c': 'ц',
      'č': 'ч',
      'š': 'ш'
    };
    var upperCase = {
      'A': 'А',
      'B': 'Б',
      'V': 'В',
      'G': 'Г',
      'Ĝ': 'Ґ',
      'D': 'Д',
      'E': 'Е',
      'Ž': 'Ж',
      'Z': 'З',
      'Y': 'И',
      'I': 'І',
      'J': 'Й',
      'K': 'К',
      'L': 'Л',
      'M': 'М',
      'N': 'Н',
      'O': 'О',
      'P': 'П',
      'R': 'Р',
      'S': 'С',
      'T': 'Т',
      'U': 'У',
      'F': 'Ф',
      'H': 'Х',
      'C': 'Ц',
      'Č': 'Ч',
      'Š': 'Ш'
    };

    var joDigraph = {
      'jo': 'йо',
      //'jo': 'ьо',
    };

    var trigrafs = {
      '\'ja': '\'я',
      '\'ji': '\'ї',
      '\'je': '\'є',
      '\'ju': '\'ю'
    }

    var digraphs = {
      ...joDigraph,
      'je': 'є',
      'ji': 'ї',
      'šč': 'щ',
      'ju': 'ю',
      'ja': 'я',
      'Je': 'Є',
      'JE': 'Є',
      'Ji': 'Ї',
      'JI': 'Ї',
      'Šč': 'Щ',
      'ŠČ': 'Щ',
      'Ju': 'Ю',
      'JU': 'Ю',
      'Ja': 'Я',
      'JA': 'Я'
    };

    var special = {
      '\'': 'ь'
      //'\'': 'Ь'
    };
    var converter = {
      ...lowerCase,
      ...upperCase,
      ...digraphs,
      ...special
    };
    var isDelimiter = {
      ' ': true,
      '.': true,
      ',': true,
      ';': true,
      '/': true,
      '\\': true,
      '(': true,
      ')': true,
      '[': true,
      ']': true,
      '!': true,
      '@': true,
      '#': true,
      '$': true,
      '*': true,
      '-': true,
      '=': true,
      '+': true,
      '_': true,
      '~': true,
      '`': true,
    };

    var i = 0;
    /*     while (i < word.length) {
          if (converter[word[i]] == undefined) {
          //skip non-mapped characters
            answer += word[i];
            i++;
          } else {
          if (i + 1 < word.length) {
              var digraph = word[i] + word[i + 1];
              if (digraphs[digraph]) {
                answer += converter[digraph];
                i += 2;
              } else {
                answer += converter[word[i]];
                i++;
              }
            } else {
              answer += converter[word[i]];
              i++;
            }
            if (i + 1 < word.lengh) {
              var digraph = word[i] + word[i + 1];
              if (digraphs[digraph]) {
                if (joDigraph[digraph]) {
                  //na počatku slova
                  if (i - 1 < 0 || isDelimiter[word[i - 1]]) {
                    answer += 'йо';
                    i += 2;
                  } else if (i - 1 >= 0 && isVowel[word[i - 1]]) {
                    answer += 'йо';
                    i += 2;
                  } else {
                    answer += 'ьо';
                    i += 2;
                  }
                } else {
                  answer += converter[digraph];
                  i += 2;
                }
              } else {
                answer += converter[word[i]];
                i++;
              }
            } else if (special[word[i]] != undefined) {
              //zastosuvaty pravyla vžyvannja m'jakogo znaku i apostrofa
                  answer += special[word[i]];
              i++;
            } else {
              answer += converter[word[i]];
              i++;
            }
          }
        } */
    while (i < word.length) {
      if (converter[word[i]] == undefined) {
        answer += word[i];
        i++;
      } else {

        if (i + 2 < word.length) { //trigraphs
          var trigraf = word[i] + word[i + 1] + word[i + 2];
          if (trigrafs[trigraf]) {
            answer += trigrafs[trigraf];
            i += 3;
          }
        }

        if (i + 1 < word.length) { //digraphs
          var digraph = word[i] + word[i + 1];
          if (joDigraph[digraph]) {
            if (shouldBeJo(word, i)) {
              answer += joDigraph[digraph];
              i += 2;
            } else {
              answer += 'ьо';
              i += 2;
            }
          } else if (digraphs[digraph]) {
            answer += converter[digraph];
            i += 2;
          }
        }

        if (i < word.length) {
          answer += converter[word[i]];
          i++;

        }
      }
    }
    return answer;
  }

  function shouldBeJo(word, i) {
      var isVowel = {
      'a': true,
      'e': true,
      'i': true,
      'o': true,
      'u': true
    };
    var isGubna = {
      'b': true,
      'p': true,
      'v': true,
      'm': true,
      'f': true
    };
    var afterVowel = i - 1 < word.length && isVowel[word[i - 1]];
    return afterVowel;
  }

  $('#submitl').click(function() {
    $('#inputl').val(function(i, val) {
      return kyrylka(val);
    });
    return false;
  });

</script>
